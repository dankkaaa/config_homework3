#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
КРАТКОЕ РУКОВОДСТВО ПО ИСПОЛЬЗОВАНИЮ АССЕМБЛЕРА УВМ

Этот файл содержит примеры использования и быстрый старт.
"""

# ============================================================================
# БЫСТРЫЙ СТАРТ
# ============================================================================

"""
1. СОЗДАЙТЕ ФАЙЛ С ИСХОДНЫМ КОДОМ (например, program.asm):

    LOAD A, 5
    LOAD B, 3
    ADD A, B
    HALT

2. АССЕМБЛИРУЙТЕ:

    python assembler.py program.asm

3. ПОЛУЧИТЕ РЕЗУЛЬТАТ:

    01 00 05 01 01 03 03 00 01 10


ДЛЯ ПОДРОБНОГО ВЫВОДА ДОБАВЬТЕ ФЛАГ -v:

    python assembler.py program.asm -v

ДЛЯ СОХРАНЕНИЯ В ФАЙЛ ИСПОЛЬЗУЙТЕ -o:

    python assembler.py program.asm -v -o result.bin
"""

# ============================================================================
# ПРИМЕРЫ ПРОГРАММ
# ============================================================================

"""
ПРИМЕР 1: Сложение двух чисел
"""
example1 = """
; Сложение 5 + 3
LOAD A, 5       ; Загрузить 5 в A
LOAD B, 3       ; Загрузить 3 в B
ADD A, B        ; Вычислить A = 5 + 3 = 8
HALT            ; Остановка
"""

"""
ПРИМЕР 2: Цикл
"""
example2 = """
; Суммирование от 1 до 5
LOAD A, 0       ; Результат = 0
LOAD B, 5       ; Счётчик = 5

loop:
ADD A, B        ; Прибавить текущее значение
SUB B, 1        ; Уменьшить счётчик
JNZ loop        ; Если B != 0, повторить цикл
HALT            ; Остановка (результат: 15)
"""

"""
ПРИМЕР 3: Условный переход
"""
example3 = """
; Проверка равенства
LOAD A, 10
LOAD B, 10
CMP A, B        ; Сравнить A и B
JZ equal        ; Если равны, прыгнуть на equal
LOAD C, 0       ; Не равны
JMP done
equal:
LOAD C, 1       ; Равны
done:
HALT
"""

"""
ПРИМЕР 4: Работа со стеком
"""
example4 = """
; Обмен значениями через стек
LOAD A, 42
LOAD B, 13
PUSH A          ; Поместить A в стек
PUSH B          ; Поместить B в стек
POP A           ; Извлечь в A (теперь 13)
POP B           ; Извлечь в B (теперь 42)
HALT            ; A и B обменялись значениями
"""

# ============================================================================
# ТАБЛИЦА КОМАНД
# ============================================================================

"""
КОМАНДЫ ПРОЦЕССОРА:

Арифметика:
  LOAD reg, val   - Загрузить значение в регистр
  ADD reg1, reg2  - Сложение
  SUB reg1, reg2  - Вычитание
  MUL reg1, reg2  - Умножение
  DIV reg1, reg2  - Деление
  MOD reg1, reg2  - Остаток от деления

Память и стек:
  STORE reg, addr - Сохранить регистр в памяти по адресу
  PUSH reg        - Поместить значение в стек
  POP reg         - Извлечь значение из стека

Условные переходы:
  CMP reg1, reg2  - Сравнить два регистра (установить флаги)
  JZ label        - Прыжок если нулевой флаг установлен
  JNZ label       - Прыжок если нулевой флаг не установлен
  JMP label       - Безусловный прыжок

Подпрограммы:
  CALL label      - Вызвать подпрограмму
  RET             - Возврат из подпрограммы

Управление:
  HALT            - Остановка программы

РЕГИСТРЫ: A, B, C, D (по 8 бит каждый)
"""

# ============================================================================
# ИНТЕРПРЕТАЦИЯ МАШИННОГО КОДА
# ============================================================================

"""
ПРИМЕР ДЕКОДИРОВАНИЯ:

Машинный код (hex): 01 00 05 01 01 03 03 00 01 10

Расшифровка:
  01 00 05      → LOAD A, 5       (опкод=01, рег=00(A), знач=05)
  01 01 03      → LOAD B, 3       (опкод=01, рег=01(B), знач=03)
  03 00 01      → ADD A, B        (опкод=03, рег1=00(A), рег2=01(B))
  10            → HALT            (опкод=10, нет операндов)

ТАБЛИЦА ОПКОДОВ:
  0x01 = LOAD
  0x02 = STORE
  0x03 = ADD
  0x04 = SUB
  0x05 = MUL
  0x06 = DIV
  0x07 = MOD
  0x08 = JMP
  0x09 = JZ
  0x0A = JNZ
  0x0B = CMP
  0x0C = CALL
  0x0D = RET
  0x0E = PUSH
  0x0F = POP
  0x10 = HALT

ТАБЛИЦА РЕГИСТРОВ:
  0 = A
  1 = B
  2 = C
  3 = D
"""

# ============================================================================
# ЧАСТО ВСТРЕЧАЮЩИЕСЯ ОШИБКИ И РЕШЕНИЯ
# ============================================================================

"""
ОШИБКА: "Неизвестная команда 'LOD'"
РЕШЕНИЕ: Команда называется LOAD (полное слово)

ОШИБКА: "Неверный операнд 'X'"
РЕШЕНИЕ: Регистры только A, B, C, D (напишите LOAD A, 10 вместо LOAD X, 10)

ОШИБКА: "Метка 'loop' уже определена"
РЕШЕНИЕ: Метка может быть только одна на программу (удалите дубликат)

ОШИБКА: "Неверное имя метки '123loop'"
РЕШЕНИЕ: Метка должна начинаться с буквы или подчёркивания (напишите loop_123)

ПРЕДУПРЕЖДЕНИЕ: "Значение 300 больше 255"
РЕШЕНИЕ: Значения должны быть 0-255. Используйте 300 & 0xFF = 44
"""

# ============================================================================
# ФЛАГИ КОМАНДНОЙ СТРОКИ
# ============================================================================

"""
python assembler.py <input_file> [options]

Обязательные аргументы:
  input_file          Путь к файлу ассемблера

Опциональные флаги:
  -o, --output FILE   Сохранить результат в файл
  -v, --verbose       Подробный вывод
  -t, --test          Режим тестирования
  -h, --help          Справка

ПРИМЕРЫ:

  python assembler.py program.asm
    └─ Ассемблировать и вывести результат в консоль

  python assembler.py program.asm -v
    └─ Подробный вывод с информацией о размере и метках

  python assembler.py program.asm -o output.bin
    └─ Сохранить результат в файл output.bin

  python assembler.py program.asm -v -o output.bin
    └─ Подробный вывод и сохранение в файл

  python assembler.py program.asm -t -v
    └─ Режим тестирования с подробным выводом
"""

# ============================================================================
# СПРАВОЧНАЯ ИНФОРМАЦИЯ
# ============================================================================

"""
СТРУКТУРА ЯЧЕЙКИ ПАМЯТИ:
  Адрес: 0-65535 (16 бит)
  Размер: 8 бит (1 байт)
  Диапазон значений: 0-255

СТЕК:
  Растёт вверх от конца памяти
  Команды PUSH и POP работают со стеком

ФЛАГИ ПРОЦЕССОРА (устанавливаются командой CMP):
  ZF (Zero Flag) - флаг нулевого результата
  Используется командами JZ и JNZ

ФОРМЫ ЗАПИСИ ЧИСЕЛ:
  Десятичная: 10, 255, 0
  Шестнадцатеричная: 0x0A, 0xFF, 0x00
  (обе формы дают один результат)

РАЗМЕРЫ:
  Регистр: 8 бит (0-255)
  Адрес: 16 бит (0-65535)
  Опкод: 8 бит (0-255)
"""

print(__doc__)
